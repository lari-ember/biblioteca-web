<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <!-- Meta Tags Essenciais -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Meta Tags para SEO -->
    {% if current_user.is_authenticated %}
    <meta name="description" content="{{ current_user.username }} gerencia {{ current_user.books|length }} livros no Amber Archivily - Sistema inteligente de biblioteca pessoal com catalogação avançada.">
    {% else %}
    <meta name="description" content="{{ description | default('Gerencie sua biblioteca pessoal, descubra livros e acesse informações detalhadas com o Amber Archivily - sua biblioteca digital inteligente.') }}">
    {% endif %}
    <meta name="keywords" content="{{ keywords | default('biblioteca digital, gerenciamento de livros, acervo pessoal, catalogação de livros, ISBN, código de barras, QR code, Open Library API, sistema de biblioteca, organização de livros, leitura digital') }}">
    <meta name="author" content="Larissa Ember">
    <meta name="robots" content="index, follow">
    <meta name="language" content="pt-BR">
    <meta name="application-name" content="Amber Archivily">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.url }}">

    <!-- Tags de Acessibilidade e Performance -->
    <meta name="theme-color" content="#220d35">
    <meta name="format-detection" content="telephone=no">
    <meta name="color-scheme" content="dark light">

    <!-- Redes Sociais (Open Graph e Twitter Cards) -->
    {% if current_user.is_authenticated %}
    <meta property="og:title" content="{{ current_user.username }}'s Biblioteca Pessoal | Amber Archivily">
    <meta property="og:description" content="Biblioteca pessoal de {{ current_user.username }} com {{ current_user.books|length }} livros catalogados e {{ current_user.sum_pages }} páginas lidas.">
    {% else %}
    <meta property="og:title" content="{{ title | default('Amber Archivily - Sua Biblioteca Digital') }}">
    <meta property="og:description" content="{{ description | default('Sistema inteligente de gerenciamento de biblioteca pessoal com recursos modernos de catalogação e organização.') }}">
    {% endif %}
    <meta property="og:image" content="{{ url_for('static', filename='images/og_image.png', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Amber Archivily">
    <meta property="og:locale" content="pt_BR">

    {% if current_user.is_authenticated %}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ current_user.username }}'s Biblioteca | Amber Archivily">
    <meta name="twitter:description" content="{{ current_user.books|length }} livros • {{ current_user.sum_pages }} páginas lidas">
    {% else %}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ title | default('Amber Archivily') }}">
    <meta name="twitter:description" content="{{ description | default('Sistema inteligente de gerenciamento de biblioteca pessoal.') }}">
    {% endif %}
    <meta name="twitter:image" content="{{ url_for('static', filename='images/twitter_image.png', _external=True) }}">

    <!-- Structured Data para SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Amber Archivily",
        "description": "Sistema de gerenciamento de biblioteca pessoal",
        "url": "{{ request.url_root }}",
        "applicationCategory": "Library Management",
        "operatingSystem": "Web Browser",
        "author": {
            "@type": "Person",
            "name": "Larissa Ember"
        }{% if current_user.is_authenticated %},
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "5",
            "reviewCount": "{{ current_user.books|length }}"
        }
        {% endif %}
    }
    </script>

    <!-- Título da Página -->
    {% if current_user.is_authenticated %}
    <title>{{ current_user.username }}'s Biblioteca | Amber Archivily</title>
    {% else %}
    <title>{{ title | default('Amber Archivily - Sua Biblioteca Digital Inteligente') }}</title>
    {% endif %}

    <!-- Preconnect para CDNs (Performance) -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload de recursos críticos -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;600;700;800;900&family=Courier+Prime:wght@400;700&display=swap" as="style">
    <link rel="preload" href="{{ url_for('static', filename='css/base.css') }}" as="style">
    <link rel="preload" href="{{ url_for('static', filename='css/components/cards.css') }}" as="style">

    <!-- Favicon e ícones -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">

    <!-- CSS - Ordem otimizada para performance -->
    <!-- 1. Bootstrap (framework base) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- 2. Fontes externas -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;600;700;800;900&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

    <!-- 3. CSS customizado na ordem correta -->
    <link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/layout.css') }}" rel="stylesheet">

    <!-- 4. Componentes CSS -->
    <link href="{{ url_for('static', filename='css/components/cards.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/components/features.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/components/buttons.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/components/forms.css') }}" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

    <!-- CSS específico da página -->
    {% if request.endpoint == 'core.index' or request.endpoint == 'index' %}
    <link href="{{ url_for('static', filename='css/pages/home.css') }}" rel="stylesheet">
    {% endif %}

    <!-- Bloco para CSS específico da página (templates filhas podem estender) -->
    {% block head %}{% endblock %}

    <!-- Scripts críticos -->
    <script>
        // Detecção de preferências do usuário
        (function() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

            document.documentElement.classList.toggle('dark-theme', prefersDark);
            document.documentElement.classList.toggle('reduced-motion', prefersReducedMotion);
        })();
    </script>
</head>

<body>
    <!-- Skip Link para acessibilidade -->
    <a href="#main-content" class="skip-link">Pular para conteúdo principal</a>

    <!-- Mobile Header -->
    <header class="mobile-header d-md-none" role="banner">
        <div class="d-flex justify-content-between align-items-center">
            <a class="navbar-brand" href="/home" aria-label="Página inicial do Amber Archivily">
                Amber Archivily
            </a>
            {% if current_user.is_authenticated %}
            <div class="user-stats-mobile">
                <small class="text-muted">{{ current_user.books|length }} livros</small>
            </div>
            {% endif %}
        </div>
    </header>

    <!-- Wrapper para desktop -->
    <div class="desktop-wrapper d-none d-md-block">
        <header role="banner">
            {% if not is_book_page %}
                {% if current_user.is_authenticated %}
                <!-- Dashboard do usuário logado -->
                <div class="user-dashboard container bg-dark text-white" id="user-info" role="complementary" aria-label="Informações do usuário">
                    <div class="d-flex justify-content-between align-items-center py-3">
                        <a class="navbar-brand text-white-50 h3 mb-0" href="/home" aria-label="Página inicial do Amber Archivily">
                            Amber Archivily
                        </a>
                        <div class="user-stats">
                            <h2 class="h5 mb-1">Bem-vindo, {{ current_user.username }}</h2>
                            <div class="stats-grid d-flex gap-4">
                                <div class="stat-item">
                                    <span class="stat-number fw-bold">{{ current_user.books|length }}</span>
                                    <span class="stat-label">livros</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number fw-bold">{{ current_user.sum_pages }}</span>
                                    <span class="stat-label">páginas lidas</span>
                                </div>
                            </div>
                        </div>
                        <div class="datetime" role="timer" aria-label="Data e hora atual">
                            <p class="text-light fw-bold mb-1">Data & Hora</p>
                            <time id="current-time" class="text-light" aria-live="polite"></time>
                            <p id="date" class="text-light mb-0" aria-live="polite"></p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Navegação principal CORRIGIDA -->
                <nav role="navigation" aria-label="Menu principal" class="main-navigation">
                    <div class="navigation">
                        <ul aria-label="Funcionalidades principais">
                            <li>
                                <a href="/home" aria-label="Ir para página inicial" aria-current="{% if request.endpoint == 'core.index' or request.endpoint == 'index' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="compass-outline"></ion-icon>
                                    </span>
                                    <span class="text">Início</span>
                                </a>
                            </li>
                            <li>
                                <a href="/register_new_book" aria-label="Registrar novo livro na biblioteca" aria-current="{% if request.endpoint == 'books.register_new_book' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="add-circle-outline"></ion-icon>
                                    </span>
                                    <span class="text">Novo Livro</span>
                                </a>
                            </li>
                            <li>
                                <a href="/your_collection" aria-label="Ver sua coleção de livros" aria-current="{% if request.endpoint == 'books.your_collection' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="library-outline"></ion-icon>
                                    </span>
                                    <span class="text">Sua Coleção</span>
                                </a>
                            </li>
                            <li>
                                <a href="/search" aria-label="Pesquisar livros" aria-current="{% if request.endpoint == 'books.search' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="search-outline"></ion-icon>
                                    </span>
                                    <span class="text">Pesquisar</span>
                                </a>
                            </li>
                            <li>
                                <a href="/about_your_library" aria-label="Estatísticas da sua biblioteca" aria-current="{% if request.endpoint == 'books.about_your_library' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="analytics-outline"></ion-icon>
                                    </span>
                                    <span class="text">Estatísticas</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.catarse.me/cirurgia_da_larissa" aria-label="Ajudar o projeto (abre em nova aba)" target="_blank" rel="external noopener noreferrer">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="heart-outline"></ion-icon>
                                    </span>
                                    <span class="text">Ajudar</span>
                                </a>
                            </li>
                            <li>
                                <a href="/profile" aria-label="Entrar em contato" aria-current="{% if request.endpoint == 'auth.profile' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="mail-outline"></ion-icon>
                                    </span>
                                    <span class="text">Contato</span>
                                </a>
                            </li>
                            {% if current_user.is_authenticated %}
                            <li>
                                <a href="/logout" aria-label="Sair da conta">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="log-out-outline"></ion-icon>
                                    </span>
                                    <span class="text">Sair</span>
                                </a>
                            </li>
                            {% else %}
                            <li>
                                <a href="/login" aria-label="Entrar na conta" aria-current="{% if request.endpoint == 'auth.login' %}page{% endif %}">
                                    <span class="icon" aria-hidden="true">
                                        <ion-icon name="log-in-outline"></ion-icon>
                                    </span>
                                    <span class="text">Entrar</span>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                        <!-- Indicator FORA do ul -->
                        <div class="indicator" aria-hidden="true"></div>
                    </div>
                </nav>
            {% endif %}
        </header>
    </div>

    <!-- Mobile Navigation CORRIGIDA -->
    <nav class="mobile-nav d-md-none" role="navigation" aria-label="Menu mobile">
        <ul>
            <li>
                <a href="/home" aria-label="Início" aria-current="{% if request.endpoint == 'core.index' or request.endpoint == 'index' %}page{% endif %}">
                    <span class="icon" aria-hidden="true">
                        <ion-icon name="compass-outline"></ion-icon>
                    </span>
                    <span class="text">Início</span>
                </a>
            </li>
            {% if current_user.is_authenticated %}
            <li>
                <a href="/register_new_book" aria-label="Novo Livro" aria-current="{% if request.endpoint == 'books.register_new_book' %}page{% endif %}">
                    <span class="icon" aria-hidden="true">
                        <ion-icon name="add-circle-outline"></ion-icon>
                    </span>
                    <span class="text">Novo</span>
                </a>
            </li>
            <li>
                <a href="/your_collection" aria-label="Sua Coleção" aria-current="{% if request.endpoint == 'books.your_collection' %}page{% endif %}">
                    <span class="icon" aria-hidden="true">
                        <ion-icon name="library-outline"></ion-icon>
                    </span>
                    <span class="text">Coleção</span>
                </a>
            </li>
            <li>
                <a href="/search" aria-label="Pesquisar" aria-current="{% if request.endpoint == 'books.search' %}page{% endif %}">
                    <span class="icon" aria-hidden="true">
                        <ion-icon name="search-outline"></ion-icon>
                    </span>
                    <span class="text">Buscar</span>
                </a>
            </li>
            <li>
                <a href="/profile" aria-label="Perfil" aria-current="{% if request.endpoint == 'auth.profile' %}page{% endif %}">
                    <span class="icon" aria-hidden="true">
                        <ion-icon name="person-outline"></ion-icon>
                    </span>
                    <span class="text">Perfil</span>
                </a>
            </li>
            {% else %}
            <li>
                <a href="/login" aria-label="Entrar" aria-current="{% if request.endpoint == 'auth.login' %}page{% endif %}">
                    <span class="icon" aria-hidden="true">
                        <ion-icon name="log-in-outline"></ion-icon>
                    </span>
                    <span class="text">Entrar</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>

    <!-- Mensagens flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages" role="alert" aria-live="assertive">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar mensagem"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Conteúdo principal -->
    <main id="main-content" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Rodapé -->
    <footer class="site-footer py-5 d-none d-md-block" role="contentinfo">
    <div class="row">
      <div class="col-12 col-md">
        <br>
        <svg class="d-block mb-2" fill="none" height="24" role="img" stroke="currentColor"
          stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"
          xmlns="http://www.w3.org/2000/svg">
          <title>Product</title>
          <circle cx="12" cy="12" r="10" />
          <path
            d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83m13.79-4l-5.74 9.94" />
        </svg>
        <small class="d-block mb-3 text-light">&copy;Larissa Ember 2022-24</small>
      </div>
      <div class="col-6 col-md">
        <h5 class="text-white">mais</h5>
        <ul class="list-unstyled text-small">
          <li><a class="link-secondary" href="#">mais projetos</a></li>
          <li><a class="link-secondary" href="#">Portfólio</a></li>
        </ul>
      </div>
      <div class="col-6 col-md">
        <h5 class="text-white">Mídia</h5>
        <ul class="list-unstyled text-small">
          <li><a class="link-secondary" href="https://discord.gg/jWzjDQSE">servidor do discord</a></li>
          <li><a class="link-secondary" href="/profile">contato</a></li>
        </ul>
      </div>
      <div class="col-6 col-md">
        <h5 class="text-white">por favor</h5>
        <ul class="list-unstyled text-small">
          <li><a class="link-secondary" href="/help">ajude-me</a></li>
          <li><a class="link-secondary" href="#">por favor</a></li>
        </ul>
      </div>
      <div class="col-6 col-md">
        <h5 class="text-white">sobre</h5>
        <ul class="list-unstyled text-small">
          <li><a class="link-secondary" href="/profile">a larissa</a></li>
          <li><a class="link-secondary" href="/copyright">copyright</a></li>
          <li><a class="link-secondary" href="/only_fans">Privacidade</a></li>
          <li><a class="link-secondary" href="/terms">termos</a></li>
        </ul>
      </div>
    </div>
  </footer>

    <!-- Scripts -->
    <!-- Scripts externos -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js" type="module"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <!-- Scripts customizados -->
    <script src="{{ url_for('static', filename='js/navigation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <!-- Scripts de componentes -->
    <script src="{{ url_for('static', filename='js/components/cards.js') }}"></script>

    <!-- Script específico da página -->
    {% if request.endpoint == 'core.index' or request.endpoint == 'index' %}
    <script src="{{ url_for('static', filename='js/components/features.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pages/home.js') }}"></script>
    {% endif %}
</body>

</html>

