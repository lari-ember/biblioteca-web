{% extends 'base.html' %}

{% block content %}
<h1 class="text-white text-center my-4">Your Collection</h1>
<div class="table-responsive-md table-responsive-sm table-responsive-xl table-responsive-lg">
  <table class="table table-striped table-hover table-dark ">
    <thead>
      <tr>
        <th>Position</th>
        <th>ID</th>
        <th>Code</th>
        <th>Title</th>
        <th>Author</th>
        <th>Pages</th>
        <th>Year</th>
        <th>Genre</th>
        <th>Read</th>
        <th>Status</th>
        <th>Format</th>
        <th>Publisher</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for book in books %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ book.id }}</td>
        <td>{{ book.code }}</td>
        <td>{{ book.title }}</td>
        <td>{{ book.author }}</td>
        <td>{{ book.pages }}</td>
        <td>{{ book.year }}</td>
        <td>{{ book.genre }}</td>
        <td>
          {% if book.read == 'read' %}
            {% if book.completion_date %}
              <span data-toggle="tooltip" data-placement="top"
                    title="{{ book.completion_date }}">
                {{ book.read }}
              </span>
            {% else %}
              {{ book.read }}
            {% endif %}
          {% else %}
            {{ book.read }}
          {% endif %}
        </td>        
        <td>{{ book.status }}</td>
        <td>{{ book.format }}</td>
        <td>{{ book.publisher }}</td>
        <td>
          <!-- Botão de edição -->
          <a href="{{ url_for('edit_book', book_id=book.id) }}" class="btn btn-outline-warning">Edit</a>
          <!-- Botão de exclusão -->
          <button class="btn btn-outline-danger" onclick="confirmDelete({{ book.id }})">Delete</button>
          <button class="btn btn-primary" onclick="openLoanPopup({{ book.id }})">Loan Book</button>
        </td>
      </tr>
      {% endfor %}
  </table>
</div>
<script>
  function confirmDelete(bookId) {
    if (confirm("Are you sure you want to delete this book?")) {
      // Redirecionar para a rota de exclusão do livro
      window.location.href = "/delete_book/" + bookId;
    }
  }
</script>
<script>
  $(document).ready(function () {
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>
<script>
  function openLoanPopup(bookId) {
      // Abre uma nova janela pop-up para a rota '/loan_book' com o ID do livro
      window.open(`/loan_book/${bookId}`, 'LoanBookWindow', 'width=600,height=400,scrollbars=yes');
  }
</script>
{% endblock %}